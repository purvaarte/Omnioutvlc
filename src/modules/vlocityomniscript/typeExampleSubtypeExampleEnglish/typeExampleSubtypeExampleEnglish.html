<template>
  <template if:true={hasErrors}>
    <lightning-layout vertical-align="stretch">
      <lightning-layout-item flexibility="auto"
                             padding="around-small"
                             class="slds-text-align_center slds-p-around_small"
                             size="1">
        <lightning-icon icon-name="utility:error"
                        alternative-text="Error!"
                        variant="error"
                        size="large">
        </lightning-icon>
      </lightning-layout-item>
      <lightning-layout-item flexibility="auto"
                             padding="around-small"
                             class="custom-box">
        <p class="slds-text-heading_medium">{allCustomLabelsUtil.OmniScriptError}</p>
        <p class="bold">{_errorMsg}</p>
        <dl class="slds-dl_inline"
            if:false={_isActiveOs}>
          <dt class="slds-dl_inline__label"><strong>{allCustomLabelsUtil.OmniScriptType}:</strong></dt>
          <dd class="slds-dl_inline__detail">typeExample</dd>
          <dt class="slds-dl_inline__label"><strong>{allCustomLabelsUtil.OmniScriptSubType}:</strong></dt>
          <dd class="slds-dl_inline__detail">subtypeExample</dd>
          <dt class="slds-dl_inline__label"><strong>{allCustomLabelsUtil.OmniScriptLang}:</strong></dt>
          <dd class="slds-dl_inline__detail">English</dd>
        </dl>
        <p class="footer-message">{allCustomLabelsUtil.OmniScriptNotFound2}</p>
      </lightning-layout-item>
    </lightning-layout>
  </template>
  <template if:false={hasErrors}>
    <template if:false={compLoaded}>
      <div class="slds-spinner-container__wrapper">
        <c-spinner variant="brand"
                   alternative-text="Loading..."
                   size="medium">
        </c-spinner>
      </div>
    </template>
    <template if:true={bSflValid}>
      <template if:true={firstRender}>
        <c-navigate-action if:true={isLauncherVisible}
                           target-type={_launcherAction.type}
                           target-params={_launcherAction.params}>
          <c-button label={inlineLabel}
                    variant={inlineVariant}
                    theme={_theme}
                    extraclass="slds-button_stretch">
          </c-button>
        </c-navigate-action>
        <article class={containerClasses}
                 data-content-position={stepChartProps.position}>
          <div class={_sideContentClasses}>
            <c-omniscript-step-chart json-def={jsonDef}
                                     json-data={jsonDef.response}
                                     if:false={jsonDef.propSetMap.hideStepChart}
                                     data-omni-key='omniscriptStepChart'
                                     props={stepChartProps}
                                     layout={layout}
                                     script-header-def={scriptHeaderDef}>
            </c-omniscript-step-chart>
            <template if:true={_isKbEnabledOnScript}>
              <c-omniscript-knowledge-base knowledge-options={kbOptions}
                                           data-omni-key='omniscriptKnowledgeBase'
                                           layout={layout}
                                           data-stepchart-placement={_stepChartPlacement}
                                           omniscript-key={scriptHeaderDef.omniscriptKey}
                                           kb-label={knowledgeLabel}>
              </c-omniscript-knowledge-base>
            </template>
          </div>
          <div data-stepborder={stepChartProps.position}
               class={contentSldsClass}>
            <template if:true={isPageLoading}>
              <c-spinner variant="brand"
                         alternative-text="Loading..."
                         extraouterclass="slds-theme_default"
                         message={spinnerMessage}
                         size="medium">
              </c-spinner>
            </template>
            <template if:true={bSflAuto}>
              <c-omniscript-save-for-later-acknowledge result={bSflResult}
                                                       layout={layout}
                                                       auto></c-omniscript-save-for-later-acknowledge>
            </template>
            <template for:each={jsonDef.children}
                      for:item="item"
                      for:index="idx">
              <c-omniscript-step if:true={item.bStep}
                                 key={item.lwcId}
                                 json-def={item}
                                 data-omni-key={item.name}
                                 json-data={jsonDef.response}
                                 json-data-str={jsonDataStr}
                                 layout={layout}
                                 resume={resume}
                                 script-header-def={scriptHeaderDef}
                                 run-mode={runMode}
                                 seed-json={jsonDef.propSetMap.seedDataJSON}><template for:each={item.children}
                          for:item="itemChild0"
                          for:index="itemChild0Idx"><template for:each={itemChild0.eleArray}
                            for:item="itemChild0Ele"
                            for:index="itemChild0Idx">
                    <c-omniscript-text if:true={itemChild0Ele.bText}
                                       key={itemChild0Ele.lwcId}
                                       json-def={itemChild0Ele}
                                       data-omni-key={itemChild0Ele.name}
                                       json-data={jsonDef.response}
                                       json-data-str={jsonDataStr}
                                       layout={layout}
                                       resume={resume}
                                       script-header-def={scriptHeaderDef}
                                       run-mode={runMode}
                                       seed-json={jsonDef.propSetMap.seedDataJSON}></c-omniscript-text>
                    <c-omniscript-textarea if:true={itemChild0Ele.bTextarea}
                                           key={itemChild0Ele.lwcId}
                                           json-def={itemChild0Ele}
                                           data-omni-key={itemChild0Ele.name}
                                           json-data={jsonDef.response}
                                           json-data-str={jsonDataStr}
                                           layout={layout}
                                           resume={resume}
                                           script-header-def={scriptHeaderDef}
                                           run-mode={runMode}
                                           seed-json={jsonDef.propSetMap.seedDataJSON}></c-omniscript-textarea>
                    <c-omniscript-date if:true={itemChild0Ele.bDate}
                                       key={itemChild0Ele.lwcId}
                                       json-def={itemChild0Ele}
                                       data-omni-key={itemChild0Ele.name}
                                       json-data={jsonDef.response}
                                       json-data-str={jsonDataStr}
                                       layout={layout}
                                       resume={resume}
                                       script-header-def={scriptHeaderDef}
                                       run-mode={runMode}
                                       seed-json={jsonDef.propSetMap.seedDataJSON}></c-omniscript-date>
                    <c-omniscript-radio if:true={itemChild0Ele.bRadio}
                                        key={itemChild0Ele.lwcId}
                                        json-def={itemChild0Ele}
                                        data-omni-key={itemChild0Ele.name}
                                        json-data={jsonDef.response}
                                        json-data-str={jsonDataStr}
                                        layout={layout}
                                        resume={resume}
                                        script-header-def={scriptHeaderDef}
                                        run-mode={runMode}
                                        seed-json={jsonDef.propSetMap.seedDataJSON}></c-omniscript-radio>
                    <c-omniscript-select if:true={itemChild0Ele.bSelect}
                                         key={itemChild0Ele.lwcId}
                                         json-def={itemChild0Ele}
                                         data-omni-key={itemChild0Ele.name}
                                         json-data={jsonDef.response}
                                         json-data-str={jsonDataStr}
                                         layout={layout}
                                         resume={resume}
                                         script-header-def={scriptHeaderDef}
                                         run-mode={runMode}
                                         seed-json={jsonDef.propSetMap.seedDataJSON}></c-omniscript-select>
                    <c-omniscript-number if:true={itemChild0Ele.bNumber}
                                         key={itemChild0Ele.lwcId}
                                         json-def={itemChild0Ele}
                                         data-omni-key={itemChild0Ele.name}
                                         json-data={jsonDef.response}
                                         json-data-str={jsonDataStr}
                                         layout={layout}
                                         resume={resume}
                                         script-header-def={scriptHeaderDef}
                                         run-mode={runMode}
                                         seed-json={jsonDef.propSetMap.seedDataJSON}></c-omniscript-number>
                    <c-omniscript-password if:true={itemChild0Ele.bPassword}
                                           key={itemChild0Ele.lwcId}
                                           json-def={itemChild0Ele}
                                           data-omni-key={itemChild0Ele.name}
                                           json-data={jsonDef.response}
                                           json-data-str={jsonDataStr}
                                           layout={layout}
                                           resume={resume}
                                           script-header-def={scriptHeaderDef}
                                           run-mode={runMode}
                                           seed-json={jsonDef.propSetMap.seedDataJSON}></c-omniscript-password>
                    <c-omniscript-text-block if:true={itemChild0Ele.bTextBlock}
                                             key={itemChild0Ele.lwcId}
                                             json-def={itemChild0Ele}
                                             data-omni-key={itemChild0Ele.name}
                                             json-data={jsonDef.response}
                                             json-data-str={jsonDataStr}
                                             layout={layout}
                                             resume={resume}
                                             script-header-def={scriptHeaderDef}
                                             run-mode={runMode}></c-omniscript-text-block>
                  </template></template></c-omniscript-step>
            </template>
            <div class="slds-grid slds-wrap slds-gutters slds-p-horizontal_medium">
              <div class="slds-col slds-size_12-of-12 slds-medium-size_6-of-12">
                <div class="omniscript-sfl-actions">
                  <div if:true={cancelAction}>
                    <c-button type="button"
                              label={cancelLabel}
                              variant="base"
                              class={navButton.save.classes}
                              onclick={cancel}>
                    </c-button>
                  </div>

                  <c-navigate-action data-omni-key="DEFAULT-CANCEL"
                                     target-type={_defaultCancel.type}
                                     target-params={_defaultCancel.params}>
                  </c-navigate-action>

                  <template if:true={allowSfl}>
                    <div>
                      <c-button type="button"
                                label={navButton.save.label}
                                variant="base"
                                class={navButton.save.classes}
                                onclick={saveForLater}>
                      </c-button>
                    </div>
                  </template>
                </div>
              </div>
              <div class="slds-col slds-size_12-of-12 slds-medium-size_6-of-12">
                <div class="slds-grid slds-wrap slds-grid_align-end">
                  <template if:true={hasPrev}>
                    <c-navigate-action if:true={_isSeoEnabled}
                                       target-type="Current Page"
                                       class={navButton.previous.classes}
                                       use-href
                                       replace
                                       target-params={navButton.previous.targetParams}>
                      <c-button type="button"
                                label={navButton.previous.label}
                                variant="brand"
                                extraclass="slds-size_1-of-1 slds-p-horizontal_none slds-text-align_center">
                      </c-button>
                    </c-navigate-action>

                    <c-button if:false={_isSeoEnabled}
                              type="button"
                              label={navButton.previous.label}
                              variant="brand"
                              class={navButton.previous.classes}
                              extraclass="slds-size_1-of-1 slds-p-horizontal_none slds-text-align_center"
                              onclick={prevStep}>
                    </c-button>
                  </template>
                  <template if:true={hasNext}>
                    <c-navigate-action if:true={_isSeoEnabled}
                                       target-type="Current Page"
                                       use-href
                                       replace
                                       class={navButton.next.classes}
                                       target-params={navButton.next.targetParams}>
                      <c-button type="button"
                                label={navButton.next.label}
                                variant="brand"
                                extraclass="slds-size_1-of-1 slds-p-horizontal_none slds-text-align_center">
                      </c-button>
                    </c-navigate-action>

                    <c-button if:false={_isSeoEnabled}
                              type="button"
                              label={navButton.next.label}
                              variant="brand"
                              class={navButton.next.classes}
                              extraclass="slds-size_1-of-1 slds-p-horizontal_none slds-text-align_center"
                              onclick={nextStep}>
                    </c-button>
                  </template>
                </div>
              </div>
            </div>
          </div>
        </article>

        <template if:true={bSflComplete}>
          <c-omniscript-save-for-later-acknowledge result={bSflResult}
                                                   layout={layout}></c-omniscript-save-for-later-acknowledge>
        </template>
        <template for:each={modalEvents}
                  for:item="modallvl1"
                  for:index="indexlvl1">
          <c-omniscript-modal data-omni-key='omnimodal'
                              key={modallvl1.modalHeader}
                              type={modallvl1.type}
                              layout={layout}
                              triggered-on-step={modallvl1.triggeredOnStep}
                              hide-footer={modallvl1.hideFooter}
                              hide-header={modallvl1.hideHeader}>
            <div slot="header">
              <h1>{modallvl1.modalHeader}</h1>
            </div>
            <div slot="content">
              <c-omniscript-formatted-rich-text value={modallvl1.modalMessage}
                                                disable-linkify></c-omniscript-formatted-rich-text>
            </div>
            <div slot="footer">
              <ul class="slds-button-group-row">
                <template for:each={modallvl1.buttons}
                          for:item="modalbutton"
                          for:index="modalbuttonindex">
                  <template if:true={modalbutton.label}>
                    <li class="slds-button-group-item"
                        key={modalbutton.key}>
                      <lightning-button label={modalbutton.label}
                                        value={indexlvl1}
                                        onclick={modalbutton.handleClick}>
                      </lightning-button>
                    </li>
                  </template>
                </template>
              </ul>
            </div>
          </c-omniscript-modal>
        </template>
      </template>
    </template>

    <template if:false={bSflValid}>
      <div class="slds-grid slds-wrap slds-gutters slds-p-horizontal_medium">
        <div class="slds-col slds-size_12-of-12 slds-medium-size_2-of-12"></div>
        <div class="slds-col slds-size_12-of-12 slds-medium-size_8-of-12">
          <div class='slds-card omniscript-save-for-later'>
            <div class="slds-card__header slds-grid">
              <header class="slds-media slds-media_center slds-has-flexi-truncate">
                <div class="slds-media__figure">
                  <lightning-icon icon-name="utility:warning"
                                  alternative-text="Ok"
                                  variant="warning"
                                  size="large"></lightning-icon>
                </div>
                <div class="slds-media__body">
                  <h2 class="slds-card__header-title">
                    <span class="slds-text-heading_large">{allCustomLabelsUtil.OmniInvalidLwcComponent}</span>
                  </h2>
                </div>
              </header>
            </div>
            <div class='slds-card__body slds-card__body_inner'>
              <p class="bold">{allCustomLabelsUtil.OmniInvalidLwcComponentMessage}</p>
              <p>&nbsp;</p>
              <div class="slds-grid slds-wrap slds-gutters slds-p-horizontal_medium">
                <div class="slds-col slds-size_12-of-12 slds-medium-size_6-of-12">
                  <lightning-button variant="brand"
                                    label={allCustomLabelsUtil.OmniContinue}
                                    title={allCustomLabelsUtil.OmniContinue}
                                    class="slds-m-left_x-small"
                                    onclick={handleContinueInvalidSfl}
                                    style="padding-left: 10px"></lightning-button>
                </div>
                <div class="slds-col slds-size_12-of-12 slds-medium-size_6-of-12"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="slds-col slds-size_12-of-12 slds-medium-size_2-of-12"></div>
      </div>
    </template>
  </template>
</template>